<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        table {
            border: 2px solid black;
        }
    </style>
    <title>Calendario</title>
</head>

<body>
    <h2>Calendario</h2>
    <p>Introduce qué fecha buscas:</p>
    <div id="pedirFecha">
        <form method="post"> <label for="dia">Día:</label>
            <input type="number" id="dia" name="dia"><br><br>

            <label for="mes">Mes:</label>
            <input type="number" id="mes" name="mes"><br><br>

            <label for="anho">Año:</label>
            <input type="number" id="anho" name="anho"><br><br>
            <button type="button"
                onclick="valoresIntro();encabezado();actualizarCalendario();rellenarCalendario();">Buscar
                Fecha</button><br><br>
            <!--OJO con el orden en onclick!!-->
        </form>

    </div>

    <!-- Un contenedor para el calendario.
            Un encabezado para mostrar el mes y el año actual.
            Botones para navegar entre meses.
            Una tabla (o divs) para representar los días del calendario.-->
    <div id="calendario">
        <table>
            <tr>
                <th colspan="2"><button type="button" onclick="atras()">-</button></th>
                <th colspan="3" id="encabezadoMes"></th>
                <th colspan="2"><button type="button" onclick="adelante()" id="add">+</button></th>
            </tr>
            <tr>
                <th>Lunes</th>
                <th>Martes</th>
                <th>Miércoles</th>
                <th>Jueves</th>
                <th>Viernes</th>
                <th>Sábado</th>
                <th>Domingo</th>
            </tr>
            <tr id="calendarioDias">
                <td id="0"></td>
                <td id="1"></td>
                <td id="2"></td>
                <td id="3"></td>
                <td id="4"></td>
                <td id="5"></td>
                <td id="6"></td>
            </tr>

        </table>

    </div>
    <script>
        let fechaGlobal;
        const encabezadoDoc = document.getElementById('encabezadoMes');
        //Variables fecha introducida
        function valoresIntro() {
            let diaIntru = parseInt(document.getElementById('dia').value)
            let mesIntru = parseInt(document.getElementById('mes').value)
            let anhoIntru = parseInt(document.getElementById('anho').value)
            console.log(mesIntru)
            fechaGlobal = new Date(anhoIntru, (mesIntru - 1), diaIntru);
            return fechaGlobal;
        }

        //array meses
        const nombresMeses = [
            'Enero',
            'Febrero',
            'Marzo',
            'Abril',
            'Mayo',
            'Junio',
            'Julio',
            'Agosto',
            'Septiembre',
            'Octubre',
            'Noviembre',
            'Diciembre'
        ];

        // encabezado calendario
        function nombreMes() {
            return nombresMeses[fechaGlobal.getMonth()];
        }

        function anhoEncabezado() {
            return fechaGlobal.getFullYear();
        }

        function mesEncabezado() {
            return fechaGlobal.getMonth();
        }
        function encabezado() {
            encabezadoDoc.innerText = nombreMes() + ' ' + anhoEncabezado();
        }

        actualizarCalendario();

        function atras() {
            let mesActual = fechaGlobal.getMonth();
            let anhoActual = fechaGlobal.getFullYear();
            if (mesActual === 0) {
                fechaGlobal = new Date(anhoActual - 1, 11, 1);
            } else {
                fechaGlobal = new Date(anhoActual, mesActual - 1, 1);
            }
            encabezado();
            actualizarCalendario();
            rellenarCalendario()

        }

        function adelante() {
            let mesActual = fechaGlobal.getMonth();
            let anhoActual = fechaGlobal.getFullYear();

            if (mesActual === 11) {
                fechaGlobal = new Date(anhoActual + 1, 0, 1);
            } else {
                fechaGlobal = new Date(anhoActual, mesActual + 1, 1);
            }

            encabezado();
            actualizarCalendario();
            rellenarCalendario()

        }

        function limpiarCalendario() {
            const celdas = document.querySelectorAll('#calendarioDias td');
            celdas.forEach(celda => {
                celda.innerText = ''; // Limpia cada celda
            });
        }
        function actualizarCalendario() {
            limpiarCalendario();
            // Crea una copia de fechaActual para evitar modificar el original
            let primerDia = new Date(fechaGlobal.getFullYear(), fechaGlobal.getMonth(), 1);

            // Obtén el día de la semana 
            let diaSemana1 = primerDia.getDay();

            diaSemana1 = diaSemana1 === 0 ? 6 : diaSemana1 - 1;

            // Encontrar la celda correspondiente y poner el día 1
            let dia = document.getElementById(diaSemana1.toString());
            dia.innerText = '1';

            return diaSemana1;

        }
        function rellenarCalendario() {
            let mesActual = fechaGlobal.getMonth();
            let anhoHoy = fechaGlobal.getFullYear();
            const mesLargo = [0, 2, 4, 6, 7, 9, 11]

            const febrero = 1
            let diasTotales = 0
            let anhoBisiesto = false
            if (mesActual === febrero) {
                if (anhoHoy % 4 === 0 && (anhoHoy % 100 !== 0 || anhoHoy % 400 === 0)) {
                    anhoBisiesto = true
                }
                if (anhoBisiesto) {
                    diasTotales = 29
                } else {
                    diasTotales = 28
                }
            }
            else if (mesLargo.includes(mesActual)) {
                diasTotales = 31
            } else {
                diasTotales = 30
            }
            /*¿Qué información necesitarías para empezar a rellenar la tabla?

                - El día de la semana donde empezar (lo tienes con actualizarCalendario())
                - Cuántos días tiene el mes (lo tienes con rellenarCalendario())

                ¿Se te ocurre cómo podrías usar un bucle para ir rellenando los días? Piensa que:

                - Necesitarás crear más filas en la tabla
                - Tendrás que ir contando los días
                - Necesitarás saber cuándo pasar a la siguiente fila*/
            let primerDiaCal = actualizarCalendario()
            let contador = 1
            let diasEnSemana = 7
            let semanasRestantes=1
            let semanas = Math.ceil(diasTotales / 7)
            for (let dia = primerDiaCal; dia < diasEnSemana; dia++) {
                let celda = document.getElementById(dia.toString());
                celda.innerText = contador.toString();
                contador++;
            }
            //SOLO TENGO HECHA LA PRIMERA SEMANA
            /* while (semanasRestantes < semanas) {
                 
 
             }*/



        }
        function mostrarCalendario() {

        }






    </script>
</body>

</html>